<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AVF首次狭窄风险评分计算器（专业版）| AVF First Stricture Risk Score Calculator (Professional Edition)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Arial', sans-serif;
        }
        body {
            background-color: #f0f5ff; /* 医疗蓝背景色 | Medical Blue Background */
            padding: 20px;
            max-width: 850px;
            margin: 0 auto;
        }
        .container {
            background: white;
            padding: 35px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(22, 93, 255, 0.1);
        }
        h1 {
            text-align: center;
            color: #165DFF; /* 医疗蓝主色 | Medical Blue Primary Color */
            margin-bottom: 30px;
            font-size: 26px;
            font-weight: 600;
            line-height: 1.5;
        }
        .header-note {
            text-align: center;
            color: #666;
            font-size: 14px;
            margin-bottom: 25px;
            line-height: 1.8;
        }
        .input-group {
            margin-bottom: 22px;
            background-color: #f8fbff;
            padding: 18px;
            border-radius: 12px;
            border-left: 4px solid #165DFF;
        }
        label {
            display: block;
            margin-bottom: 10px;
            color: #2d3748;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
        }
        label::before {
            content: "●";
            color: #165DFF;
            margin-right: 8px;
            font-size: 8px;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 14px 18px;
            font-size: 16px;
            border: 1px solid #e1e7f5;
            border-radius: 8px;
            transition: all 0.3s;
            background-color: white;
        }
        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #165DFF;
            box-shadow: 0 0 0 3px rgba(22, 93, 255, 0.1);
        }
        .form-row {
            display: flex;
            gap: 22px;
            margin-bottom: 22px;
        }
        .form-col {
            flex: 1;
        }
        /* 折叠面板样式（风险因素说明）| Collapsible Panel Style (Risk Factor Explanation) */
        details {
            margin-top: 10px;
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
            border: 1px solid #e1e7f5;
        }
        summary {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            color: #165DFF;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        summary::after {
            content: "▼";
            font-size: 10px;
            margin-left: 8px;
            transition: transform 0.2s;
        }
        details[open] summary::after {
            transform: rotate(180deg);
        }
        .detail-content {
            padding: 0 15px 15px;
            font-size: 13px;
            color: #666;
            line-height: 1.8;
        }
        .detail-content .en {
            color: #888;
            margin-top: 5px;
        }
        .btn-group {
            display: flex;
            gap: 15px;
            margin: 30px 0 20px;
        }
        .btn-calculate, .btn-reset, .btn-export {
            flex: 1;
            padding: 16px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn-calculate {
            background-color: #165DFF;
            color: white;
        }
        .btn-calculate:hover {
            background-color: #0d47a1;
        }
        .btn-reset {
            background-color: #f5f7fa;
            color: #4a5568;
            border: 1px solid #e1e7f5;
        }
        .btn-reset:hover {
            background-color: #edf2f7;
        }
        .btn-export {
            background-color: #36CFC9;
            color: white;
        }
        .btn-export:hover {
            background-color: #28b8b1;
        }
        .result-section {
            margin-top: 35px;
            padding: 30px;
            background-color: #f8fbff;
            border-radius: 16px;
            border: 1px solid #e1e7f5;
        }
        .result-title {
            font-size: 20px;
            color: #165DFF;
            margin-bottom: 25px;
            font-weight: 600;
            text-align: center;
            position: relative;
        }
        .result-title::after {
            content: "";
            display: block;
            width: 60px;
            height: 3px;
            background-color: #165DFF;
            margin: 8px auto 0;
            border-radius: 3px;
        }
        .result-card {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e1e7f5;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-label {
            color: #4a5568;
            font-size: 16px;
            width: 35%;
            display: flex;
            align-items: center;
        }
        .result-label::after {
            content: "";
            flex: 1;
            height: 1px;
            background-color: #e1e7f5;
            margin: 0 10px;
        }
        .result-label .en {
            font-size: 12px;
            color: #888;
            margin-left: 8px;
            font-weight: normal;
        }
        .result-value {
            color: #2d3748;
            font-size: 18px;
            font-weight: 600;
            width: 65%;
            text-align: right;
        }
        .risk-level {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            display: inline-block;
        }
        .low-risk {
            background-color: #e6f7ef;
            color: #00b42a;
        }
        .medium-risk {
            background-color: #fff7e6;
            color: #ff7d00;
        }
        .high-risk {
            background-color: #ffe8e8;
            color: #f53f3f;
        }
        /* 修复：中文类名改为英文，避免浏览器解析错误 */
        .error-tip {
            color: #f53f3f;
            font-size: 14px;
            margin-top: 6px;
            display: none;
            margin-left: 2px;
        }
        .error-tip .en {
            color: #ff6b6b;
            font-size: 12px;
            display: block;
        }
        .note {
            margin-top: 8px;
            font-size: 13px;
            color: #718096;
            line-height: 1.8;
        }
        .note .en {
            color: #888;
            font-size: 12px;
            display: block;
            margin-top: 3px;
        }
        .export-count {
            text-align: right;
            color: #666;
            font-size: 13px;
            margin-bottom: 10px;
        }
        .export-count .en {
            color: #888;
            font-size: 11px;
            display: block;
        }
        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
                gap: 18px;
            }
            .container {
                padding: 25px;
            }
            h1 {
                font-size: 22px;
            }
            .btn-group {
                flex-direction: column;
                gap: 12px;
            }
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .result-value {
                width: 100%;
                text-align: left;
            }
            .result-label::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AVF首次狭窄风险评分计算器<br>AVF First Stricture Risk Score Calculator</h1>
        <div class="header-note">
            适用于血液透析患者动静脉内瘘狭窄风险评估 | For Hemodialysis Patients with Arteriovenous Fistula (AVF) Stricture Risk Assessment<br>
            输入患者信息自动计算评分及发生率 | Auto-calculate Score and Stricture Rate by Entering Patient Information
        </div>

        <!-- 输入区域 | Input Section -->
        <form id="scoreForm">
            <!-- 基本信息 | Basic Information -->
            <div class="form-row">
                <div class="form-col input-group">
                    <label for="patientId">患者ID（Patient ID）*</label>
                    <input type="text" id="patientId" placeholder="请输入患者唯一标识（如：P2024001）| Enter unique ID (e.g., P2024001)">
                    <div class="error-tip" id="idError">请填写患者ID <span class="en">Please enter patient ID</span></div>
                </div>
                <div class="form-col input-group">
                    <label for="patientName">患者姓名（Patient Name）*</label>
                    <input type="text" id="patientName" placeholder="请输入患者姓名（如：张三）| Enter patient name (e.g., Zhang San)">
                    <div class="error-tip" id="nameError">请填写患者姓名 <span class="en">Please enter patient name</span></div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-col input-group">
                    <label for="gender">性别（Gender）*</label>
                    <select id="gender">
                        <option value="">请选择 | Please select</option>
                        <option value="男">男（Male）</option>
                        <option value="女">女（Female）</option>
                    </select>
                    <div class="error-tip" id="genderError">请选择性别 <span class="en">Please select gender</span></div>
                </div>
                <div class="form-col input-group">
                    <label for="age">年龄（Age，岁/y）*</label>
                    <input type="number" id="age" placeholder="如：55 | e.g., 55" step="any">
                    <div class="error-tip" id="ageError">请输入有效年龄（18-120岁）<span class="en">Please enter valid age (18-120 years)</span></div>
                </div>
            </div>

            <!-- 风险因素输入 | Risk Factor Input -->
            <div class="input-group">
                <label for="surgeryCount">1. 手术次数（Surgery Count）*</label>
                <input type="number" id="surgeryCount" placeholder="如：1 | e.g., 1" min="0" step="1">
                <div class="error-tip" id="surgeryError">请输入有效次数（≥0的整数）<span class="en">Please enter valid number (integer ≥0)</span></div>
                <div class="note">
                    评分规则：0次=0分，1次=1分，≥2次=3分（OR=2.08，风险因素）| Scoring Rule: 0 points for 0 times, 1 point for 1 time, 3 points for ≥2 times (OR=2.08, Risk Factor)
                </div>
                <details>
                    <summary>查看详细说明 | View Detailed Explanation</summary>
                    <div class="detail-content">
                        指标定义：患者既往接受的内瘘相关手术次数（含首次造瘘手术）<br>
                        <span class="en">Definition: Number of previous fistula-related surgeries (including initial fistula creation)</span><br>
                        临床意义：多次手术通过机械创伤和炎症反应促进新生内膜增生，形成"血管损伤累积"效应，显著升高狭窄风险<br>
                        <span class="en">Clinical Significance: Multiple surgeries promote neointimal hyperplasia through mechanical trauma and inflammatory responses, forming "vascular injury accumulation" and significantly increasing stricture risk</span><br>
                        统计依据：每增加1次手术，狭窄风险升高2.08倍（95%CI:1.52-2.84，p<0.0001）<br>
                        <span class="en">Statistical Basis: Each additional surgery increases stricture risk by 2.08 times (95%CI:1.52-2.84, p<0.0001)</span>
                    </div>
                </details>
            </div>

            <div class="input-group">
                <label for="thrombosis">2. 血栓病史（Thrombosis History）*</label>
                <select id="thrombosis">
                    <option value="">请选择 | Please select</option>
                    <option value="1">有（Yes）</option>
                    <option value="0">无（No）</option>
                </select>
                <div class="error-tip" id="thrombosisError">请选择是否有血栓病史 <span class="en">Please select thrombosis history</span></div>
                <div class="note">
                    评分规则：有=1分，无=0分（OR=1.96，风险因素）| Scoring Rule: 1 point for yes, 0 points for no (OR=1.96, Risk Factor)
                </div>
                <details>
                    <summary>查看详细说明 | View Detailed Explanation</summary>
                    <div class="detail-content">
                        指标定义：患者既往是否发生过与AVF相关的血栓形成事件（经超声或血管造影证实）<br>
                        <span class="en">Definition: Whether the patient has a history of AVF-related thrombosis (confirmed by ultrasound or angiography)</span><br>
                        临床意义：血栓病史与狭窄风险密切相关，反映血管内皮功能损伤和凝血状态异常<br>
                        <span class="en">Clinical Significance: Thrombosis history is closely associated with stricture risk, reflecting vascular endothelial injury and abnormal coagulation</span><br>
                        统计依据：有血栓病史患者的狭窄风险是无血栓病史患者的1.96倍（95%CI:1.08-3.57，p=0.0266）<br>
                        <span class="en">Statistical Basis: Patients with thrombosis history have 1.96 times higher stricture risk than those without (95%CI:1.08-3.57, p=0.0266)</span>
                    </div>
                </details>
            </div>

            <div class="input-group">
                <label for="noSurgeryFirstYear">3. 术后1年未手术（No Surgery First Year）*</label>
                <select id="noSurgeryFirstYear">
                    <option value="">请选择 | Please select</option>
                    <option value="1">是（Yes）</option>
                    <option value="0">否（No）</option>
                </select>
                <div class="error-tip" id="noSurgeryError">请选择是否术后1年未手术 <span class="en">Please select no surgery within first year</span></div>
                <div class="note">
                    评分规则：是=2分，否=0分（OR=0.42，保护因素）| Scoring Rule: 2 points for yes, 0 points for no (OR=0.42, Protective Factor)
                </div>
                <details>
                    <summary>查看详细说明 | View Detailed Explanation</summary>
                    <div class="detail-content">
                        指标定义：AVF首次造瘘术后1年内，未因狭窄、血栓等并发症接受任何手术干预<br>
                        <span class="en">Definition: No surgical intervention for complications such as stricture or thrombosis within 1 year after initial AVF creation</span><br>
                        临床意义：术后1年无手术史表明内瘘成熟良好，血管生物学特性优异，长期预后更佳<br>
                        <span class="en">Clinical Significance: No surgery within 1 year indicates well-matured fistula with favorable vascular biology and better long-term prognosis</span><br>
                        统计依据：术后1年未手术患者的狭窄风险降低58.5%（95%CI:0.28-0.63，p<0.0001）<br>
                        <span class="en">Statistical Basis: Patients with no surgery within 1 year have 58.5% lower stricture risk (95%CI:0.28-0.63, p<0.0001)</span>
                    </div>
                </details>
            </div>

            <div class="input-group">
                <label for="hemoglobin">4. 血红蛋白浓度（Hemoglobin，g/L）*</label>
                <input type="number" id="hemoglobin" placeholder="如：95 | e.g., 95" step="any">
                <div class="error-tip" id="hemoglobinError">请输入有效浓度（60-150g/L）<span class="en">Please enter valid concentration (60-150g/L)</span></div>
                <div class="note">
                    评分规则：≤90g/L=0分，>90g/L=1分（OR=1.01，风险因素）| Scoring Rule: 0 points for ≤90g/L, 1 point for >90g/L (OR=1.01, Risk Factor)
                </div>
                <details>
                    <summary>查看详细说明 | View Detailed Explanation</summary>
                    <div class="detail-content">
                        指标定义：空腹静脉血检测的血红蛋白浓度（常规实验室检测指标）<br>
                        <span class="en">Definition: Fasting venous blood hemoglobin concentration (routine laboratory indicator)</span><br>
                        临床意义：血红蛋白升高可增加血液粘稠度，改变血流动力学，通过调节HIF-1α表达参与狭窄发病机制<br>
                        <span class="en">Clinical Significance: Elevated hemoglobin increases blood viscosity, alters hemodynamics, and participates in stricture pathogenesis by regulating HIF-1α expression</span><br>
                        统计依据：血红蛋白每升高1g/L，狭窄风险升高1.01倍（95%CI:1.00-1.02，p=0.0049）<br>
                        <span class="en">Statistical Basis: Each 1g/L increase in hemoglobin increases stricture risk by 1.01 times (95%CI:1.00-1.02, p=0.0049)</span>
                    </div>
                </details>
            </div>

            <!-- 导出计数提示 | Export Count Prompt -->
            <div class="export-count">
                当前已记录 <span id="recordCount">0</span> 条评分结果 | <span class="en">Total <span id="recordCountEn">0</span> score records saved</span>
            </div>

            <!-- 按钮组 | Button Group -->
            <div class="btn-group">
                <button type="button" class="btn-calculate" onclick="calculateScore()">计算风险评分（Calculate Risk Score）</button>
                <button type="button" class="btn-reset" onclick="resetForm()">重置输入（Reset Input）</button>
                <button type="button" class="btn-export" onclick="exportRecords()">导出评分记录（Export Score Records）</button>
            </div>
        </form>

        <!-- 结果显示区域 | Result Display Section -->
        <div class="result-section" style="display: none;">
            <div class="result-title">评分结果（Score Result）</div>
            <div class="result-card">
                <div class="result-item">
                    <span class="result-label">患者ID <span class="en">Patient ID</span>：</span>
                    <span class="result-value" id="resultId">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">患者姓名 <span class="en">Patient Name</span>：</span>
                    <span class="result-value" id="resultName">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">性别 <span class="en">Gender</span>：</span>
                    <span class="result-value" id="resultGender">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">年龄 <span class="en">Age</span>：</span>
                    <span class="result-value" id="resultAge">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">总评分 <span class="en">Total Score</span>：</span>
                    <span class="result-value" id="totalScore">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">风险等级 <span class="en">Risk Level</span>：</span>
                    <span class="result-value">
                        <span class="risk-level" id="riskLevel">-</span>
                    </span>
                </div>
                <div class="result-item">
                    <span class="result-label">狭窄发生率 <span class="en">Stricture Rate</span>：</span>
                    <span class="result-value" id="strictureRate">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">评估时间 <span class="en">Evaluation Time</span>：</span>
                    <span class="result-value" id="evaluateTime">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 存储评分记录（用于导出）| Store score records (for export)
        let scoreRecords = [];

        // 评分计算核心函数 | Core score calculation function
        function calculateScore() {
            // 1. 获取输入值 | Get input values
            const patientId = document.getElementById('patientId').value.trim();
            const patientName = document.getElementById('patientName').value.trim();
            const gender = document.getElementById('gender').value;
            const age = parseFloat(document.getElementById('age').value);
            const surgeryCount = parseInt(document.getElementById('surgeryCount').value);
            const thrombosis = parseInt(document.getElementById('thrombosis').value);
            const noSurgeryFirstYear = parseInt(document.getElementById('noSurgeryFirstYear').value);
            const hemoglobin = parseFloat(document.getElementById('hemoglobin').value);

            // 2. 验证输入 | Validate input
            let isValid = true;
            if (!patientId) { showError('idError'); isValid = false; } else { hideError('idError'); }
            if (!patientName) { showError('nameError'); isValid = false; } else { hideError('nameError'); }
            if (!gender) { showError('genderError'); isValid = false; } else { hideError('genderError'); }
            if (isNaN(age) || age < 18 || age > 120) { showError('ageError'); isValid = false; } else { hideError('ageError'); }
            if (isNaN(surgeryCount) || surgeryCount < 0) { showError('surgeryError'); isValid = false; } else { hideError('surgeryError'); }
            if (isNaN(thrombosis)) { showError('thrombosisError'); isValid = false; } else { hideError('thrombosisError'); }
            if (isNaN(noSurgeryFirstYear)) { showError('noSurgeryError'); isValid = false; } else { hideError('noSurgeryError'); }
            if (isNaN(hemoglobin) || hemoglobin < 60 || hemoglobin > 150) { showError('hemoglobinError'); isValid = false; } else { hideError('hemoglobinError'); }

            // 3. 验证失败则返回 | Return if validation fails
            if (!isValid) return;

            // 4. 计算各项得分 | Calculate scores for each item
            let score = 0;
            // 年龄评分 | Age scoring
            if (age < 60) score += 0;
            else if (age >= 60 && age <= 75) score += 1;
            else score += 2;
            // 手术次数评分 | Surgery count scoring
            if (surgeryCount === 0) score += 0;
            else if (surgeryCount === 1) score += 1;
            else score += 3;
            // 血栓病史评分 | Thrombosis history scoring
            score += thrombosis === 1 ? 1 : 0;
            // 术后1年未手术评分 | No surgery first year scoring
            score += noSurgeryFirstYear === 1 ? 2 : 0;
            // 血红蛋白评分 | Hemoglobin scoring
            score += hemoglobin > 90 ? 1 : 0;

            // 5. 判定风险等级和狭窄发生率 | Determine risk level and stricture rate
            let riskLevel, riskLevelEn, strictureRate, riskClass;
            if (score <= 3) {
                riskLevel = "低危组";
                riskLevelEn = "Low-Risk Group";
                strictureRate = "15.7%";
                riskClass = "low-risk";
            } else if (score >= 4 && score <= 5) {
                riskLevel = "中危组";
                riskLevelEn = "Intermediate-Risk Group";
                strictureRate = "43.5%";
                riskClass = "medium-risk";
            } else {
                riskLevel = "高危组";
                riskLevelEn = "High-Risk Group";
                strictureRate = "64.0%";
                riskClass = "high-risk";
            }

            // 6. 获取当前时间 | Get current time
            const evaluateTime = new Date().toLocaleString('zh-CN', { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit', second: '2-digit' 
            });
            const evaluateTimeEn = new Date().toLocaleString('en-US', {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false
            });

            // 7. 显示结果 | Display results
            document.querySelector('.result-section').style.display = 'block';
            document.getElementById('resultId').textContent = patientId;
            document.getElementById('resultName').textContent = patientName;
            document.getElementById('resultGender').textContent = gender === '男' ? '男（Male）' : '女（Female）';
            document.getElementById('resultAge').textContent = `${age.toFixed(1)} 岁 | ${age.toFixed(1)} years`;
            document.getElementById('totalScore').textContent = `${score} 分（满分9分）| ${score} / 9 Points`;
            const riskLevelElem = document.getElementById('riskLevel');
            riskLevelElem.textContent = `${riskLevel}（${riskLevelEn}）`;
            riskLevelElem.className = `risk-level ${riskClass}`;
            document.getElementById('strictureRate').textContent = strictureRate;
            document.getElementById('evaluateTime').textContent = `${evaluateTime} | ${evaluateTimeEn}`;

            // 8. 保存记录到数组（中英对照）| Save record to array (Chinese-English)
            const record = {
                "患者ID（Patient ID）": patientId,
                "患者姓名（Patient Name）": patientName,
                "性别（Gender）": gender === '男' ? '男（Male）' : '女（Female）',
                "年龄（Age, y）": age.toFixed(1) + " 岁",
                "手术次数（Surgery Count）": surgeryCount + " 次",
                "血栓病史（Thrombosis History）": thrombosis === 1 ? "有（Yes）" : "无（No）",
                "术后1年未手术（No Surgery First Year）": noSurgeryFirstYear === 1 ? "是（Yes）" : "否（No）",
                "血红蛋白浓度（Hemoglobin, g/L）": hemoglobin.toFixed(1) + " g/L",
                "总评分（Total Score）": score + " 分",
                "风险等级（Risk Level）": `${riskLevel}（${riskLevelEn}）`,
                "狭窄发生率（Stricture Rate）": strictureRate,
                "评估时间（Evaluation Time）": `${evaluateTime} | ${evaluateTimeEn}`
            };
            scoreRecords.push(record);
            document.getElementById('recordCount').textContent = scoreRecords.length;
            document.getElementById('recordCountEn').textContent = scoreRecords.length;
        }

        // 原生CSV导出功能（无外部依赖）| Native CSV Export Function (No Dependencies)
        function exportRecords() {
            // 1. 验证是否有评分记录
            if (scoreRecords.length === 0) {
                alert("暂无评分记录可导出，请先计算患者评分 | No score records to export, please calculate patient scores first");
                return;
            }

            try {
                // 2. 生成CSV表头
                const headers = Object.keys(scoreRecords[0]);
                // 3. 生成CSV内容（处理中文和特殊字符）
                let csvRows = [headers.join(",")];
                scoreRecords.forEach(function(row) {
                    const rowData = headers.map(function(key) {
                        const value = row[key] || "";
                        // 转义双引号，避免CSV格式错误
                        return "\"" + value.toString().replace(/"/g, '""') + "\"";
                    });
                    csvRows.push(rowData.join(","));
                });
                const csvContent = csvRows.join("\n");

                // 4. 创建Blob并下载（添加UTF-8 BOM头，解决中文乱码）
                const blob = new Blob(["\ufeff" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                // 格式化日期作为文件名
                const today = new Date();
                const dateStr = today.getFullYear() + "-" + (today.getMonth() + 1).toString().padStart(2, "0") + "-" + today.getDate().toString().padStart(2, "0");
                a.download = "AVF狭窄评分记录_" + dateStr + ".csv";
                // 确保DOM元素添加完成后再触发点击
                document.body.appendChild(a);
                setTimeout(function() {
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 0);

                // 5. 导出成功提示
                alert("评分记录已成功导出为CSV文件（可直接用Excel打开）| Score records exported as CSV (open with Excel)");
            } catch (error) {
                console.error("导出失败详细信息：", error);
                alert("导出失败，请重试 | Export failed, please try again");
            }
        }

        // 错误提示显示/隐藏函数 | Error prompt show/hide function
        function showError(id) {
            const errorElem = document.getElementById(id);
            if (errorElem) {
                errorElem.style.display = 'block';
            }
        }

        function hideError(id) {
            const errorElem = document.getElementById(id);
            if (errorElem) {
                errorElem.style.display = 'none';
            }
        }

        // 重置表单函数 | Reset form function
        function resetForm() {
            document.getElementById('scoreForm').reset();
            document.querySelector('.result-section').style.display = 'none';
            const errors = document.querySelectorAll('.error-tip');
            errors.forEach(function(error) {
                error.style.display = 'none';
            });
        }
    </script>
</body>
</html>
